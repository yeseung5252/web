<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATEGORY</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 최소한의 스타일 정의 (style.css에 없다면) */
        body { margin: 0; font-family: Leeseoyun, sans-serif; background-color: #f4f4f4; }
        .page-content { padding: 40px 20px; max-width: 1200px; margin: 0 auto; }
        .tab-menu { display: flex; justify-content: center; margin-bottom: 30px; border-bottom: 2px solid #ddd; }
        .tab-item { padding: 10px 20px; cursor: pointer; text-decoration: none; color: #555; font-weight: bold; transition: color 0.3s, border-bottom 0.3s; }
        .tab-item.active { color: #000; border-bottom: 3px solid #000; }
        .product-link { text-decoration: none; color: inherit; }
        .product-list-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 30px; }
        .product-item { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); text-align: center; position: relative; }
        .product-item img { width: 100%; height: auto; border-radius: 6px; margin-bottom: 10px; }
        .product-item h3 { font-size: 1.1em; margin: 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .price { font-weight: bold; color: #333; }
        .bookmark-icon {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.5em;
            cursor: pointer;
            color: #ccc;
            user-select: none;
            line-height: 1; /* 아이콘 위치 조정 */
            z-index: 10;
        }
        .bookmark-icon.bookmarked {
            color: #e74c3c;
        }
    </style>
</head>
<body>

    <div class="page-content">
        <h1>CATEGORY</h1>

        <nav class="tab-menu">
            <a href="#" class="tab-item active" data-category="all">전체</a>
            <a href="#" class="tab-item" data-category="diary">다이어리</a>
            <a href="#" class="tab-item" data-category="sticker">스티커</a>
            <a href="#" class="tab-item" data-category="tape">마스킹테이프</a>
            <a href="#" class="tab-item" data-category="binder">바인더</a>
            <a href="#" class="tab-item" data-category="cover">커버</a>
            <a href="#" class="tab-item" data-category="kisscut">키스컷</a>
            <a href="#" class="tab-item" data-category="modoji">모조지</a>
        </nav>

        <div class="product-list-container" id="product-list-container">
            </div>
    </div>

    <script>
        // ---------------------------------------------
        // 1. 상품 데이터 정의 (북마크 테스트를 위해 ID는 고유해야 함)
        // ---------------------------------------------
        const products = [
            { id: 1, name: "호보니치 테쵸 다이어리", category: "diary", price: 45400, img: "prod-1.jpg", link:"https://smartstore.naver.com/_bestpen/products/12338987905?nl-query=%ED%98%B8%EB%B3%B4%EB%8B%88%EC%B9%98+2026&nl-ts-pid=jgw0VlqX6IdssfVc9f0-420469&NaPm=ct%3Dmj30v9r4%7Cci%3D7a4ddc04d76cc5a9dbcc00c9b3c5eaebb274ff25%7Ctr%3Dimg%7Csn%3D457624%7Chk%3D7bd37faf06f06779dcbcc41570addf0d41ae28f1" },
            { id: 2, name: "핑루 딸기초코 스티커팩", category: "sticker", price: 8000, img: "prod-2.jpg", link:"http://www.10x10.co.kr/shopping/category_prd.asp?itemid=6779971" },
            { id: 3, name: "어버블크러쉬 A7 6공 바인더", category: "binder", price: 20000, img: "prod-3.jpg", link:"https://smartstore.naver.com/sosorowa/products/11877022826" },
            { id: 4, name: "도롱상점 음표 젤리 MT", category: "tape", price: 4000, img: "prod-4.jpg", link:"https://smartstore.naver.com/dorong_ham/products/10490896026" },
            { id: 5, name: "지구침략 초코바나나 모조지", category: "modoji", price: 3000, img: "prod-5.jpg", link:"https://smartstore.naver.com/chuplay/products/11549780555" },
            { id: 6, name: "제키베어 패턴별 키스컷", category: "kisscut", price: 6000, img: "prod-6.jpg", link:"https://smartstore.naver.com/helloplay/products/11958162205" },
            { id: 7, name: "페이젬 다이어리", category: "diary", price: 21900, img: "prod-7.jpg", link:"https://www.coupang.com/vp/products/8405289397?itemId=24299267108&vendorItemId=91315257515&src=1032001&spec=10305199&addtag=400&ctag=8405289397&lptag=I24299267108&itime=20251213002925&pageType=PRODUCT&pageValue=8405289397&wPcid=17552633397573116103713&wRef=cr.shopping.naver.com&wTime=20251213002925&redirect=landing&mcid=b92706fd02d14de3a9117b355a300936&n_keyword=&n_ad_group=&n_ad=&n_ad=&n_rank=&n_keyword_id=&n_media=&n_campaign_type=&n_query=" },
            { id: 8, name: "B6 다이어리 PVC 커버", category: "cover", price: 1500, img: "prod-8.jpg", link:"http://www.10x10.co.kr/shopping/category_prd.asp?itemid=6438417" },
            { id: 9, name: "도미월드 무광칼선스티커", category: "sticker", price: 5500, img: "prod-9.jpg", link:"https://smartstore.naver.com/dudumoon/products/7624754781?nl-query=%EB%8F%84%EB%AF%B8%EC%9B%94%EB%93%9C+%EC%8A%A4%ED%8B%B0%EC%BB%A4&nl-ts-pid=jgw3EwqX6IdssfVb32C-357965&NaPm=ct%3Dmj31ba54%7Cci%3Ddfa20f8029496a7d24323f318ce0888025c992fd%7Ctr%3Dimg%7Csn%3D931564%7Chk%3Ddf1cf010bb96fff77bcb986361b5eb31d1fbb2cb" },
        ];

        const tabs = document.querySelectorAll('.tab-item');
        const productContainer = document.getElementById('product-list-container');
        
        // ---------------------------------------------
        // 2. HTML 구조 생성 함수 (유지)
        // ---------------------------------------------
        function createProductHtml(product) {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const isBookmarked = bookmarks.includes(product.id);
            const heartIcon = isBookmarked ? '♥' : '♡';
            const heartClass = isBookmarked ? 'bookmarked' : '';

            return `
                <a href="${product.link}" target="_blank" class="product-link">
                    <div class="product-item">
                        <img src="${product.img}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p class="price">${product.price.toLocaleString()}원</p>
                        
                        <span class="bookmark-icon ${heartClass}" data-product-id="${product.id}">
                            ${heartIcon}
                        </span>
                    </div>
                </a>
            `;
        }

        // ---------------------------------------------
        // 3. 북마크 리스너 연결 함수 (유지)
        // ---------------------------------------------
        function attachBookmarkListeners() {
            document.querySelectorAll('.bookmark-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.preventDefault();   
                    e.stopPropagation();  
                    
                    const productId = parseInt(icon.dataset.productId);
                    let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');

                    if (icon.classList.contains('bookmarked')) {
                        // 북마크 제거
                        bookmarks = bookmarks.filter(id => id !== productId);
                        icon.classList.remove('bookmarked');
                        icon.textContent = '♡';
                    } else {
                        // 북마크 추가
                        bookmarks.push(productId);
                        icon.classList.add('bookmarked');
                        icon.textContent = '♥';
                    }

                    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                });
            });
        }
        
        // ---------------------------------------------
        // 4. 상품 목록 렌더링 및 필터링 로직 (검색어 처리 로직 강화)
        // ---------------------------------------------
        function renderProducts(filterCategory, searchQuery = null) {
            let filteredProducts = products;

            // ⭐️ 카테고리 한국어 매핑 테이블 (검색어 비교에 사용)
            const categoryMap = {
                'diary': '다이어리',
                'cover': '커버',
                'binder': '바인더',
                'sticker': '스티커',
                'tape': '마스킹테이프',
                'kisscut': '키스컷',
                'modoji': '모조지'
            };
            
            // 1. 카테고리 필터링 (탭 클릭 시)
            if (filterCategory && filterCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.category.includes(filterCategory)
                );
            }
            
            // 2. 검색어 필터링 (검색어가 있을 경우)
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredProducts = filteredProducts.filter(product => {
                    
                    // ⭐️ 상품 이름 (한글)에 검색어가 포함되는지 확인
                    const nameMatch = product.name.toLowerCase().includes(query);
                    
                    // ⭐️ 카테고리 한글 이름에 검색어가 포함되는지 확인
                    const categoryKoreanName = categoryMap[product.category] || '';
                    const categoryMatch = categoryKoreanName.toLowerCase().includes(query);
                    
                    // 둘 중 하나라도 일치하면 표시
                    return nameMatch || categoryMatch;
                });
            }
            
            // 3. 결과 표시
            if (filteredProducts.length === 0) {
                productContainer.innerHTML = `<p style="text-align: center; margin-top: 50px;">
                                                검색 결과가 없습니다.
                                            </p>`;
            } else {
                const productHtml = filteredProducts.map(createProductHtml).join('');
                productContainer.innerHTML = productHtml;
            }

            attachBookmarkListeners(); 
        }

        // ---------------------------------------------
        // 5. 탭 클릭 이벤트 핸들러 (유지)
        // ---------------------------------------------
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                tabs.forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                const selectedCategory = e.target.dataset.category;
                
                // 탭 클릭 시에는 검색어 없이 카테고리만 필터링
                renderProducts(selectedCategory, null); 
            });
        });

        // ---------------------------------------------
        // 6. 페이지 로드 시 초기화 로직 (URL 검색어 처리)
        // ---------------------------------------------
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            // ⭐️ 'search' 쿼리 파라미터를 정확히 가져옴
            const searchQuery = urlParams.get('search');
            
            if (searchQuery) {
                // 검색어가 있으면
                tabs.forEach(t => t.classList.remove('active'));
                document.querySelector('.tab-item[data-category="all"]').classList.add('active');
                
                // 디코딩된 검색어를 사용해 상품 렌더링
                const decodedQuery = decodeURIComponent(searchQuery);
                renderProducts('all', decodedQuery);
                
                // 사용자에게 검색 결과를 표시
                const title = document.querySelector('.page-content h1');
                title.textContent = `CATEGORY - "${decodedQuery}" 검색 결과`;
                
            } else {
                // 검색어가 없으면 기본 '전체' 탭 클릭으로 모든 상품 표시
                document.querySelector('.tab-item[data-category="all"]').click(); 
            }
        };
    </script>
</body>
</html>